<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.adnstyle.myboard.model.repository.MyBoardRepository">

<!--    검색-->
    <sql id ="searchContents">
        <choose>
            <when test='type.equals("A")'>
                <if test='search==""'></if>
                <if test='search!=""'>
                    where title like concat('%',#{search},'%')
                    or
                    created_by like concat('%',#{search},'%')
                    or
                    content like concat('%',#{search},'%')
                </if>
            </when>
            <when test='type.equals("T")'>
                where title like concat('%',#{search},'%')
            </when>
            <when test='type.equals("W")'>
                where created_by like concat('%',#{search},'%')
            </when>
            <when test='type.equals("C")'>
                where content like concat('%',#{search},'%')
            </when>
            <when test='type.equals("TC")'>
                where title like concat('%',#{search},'%') or content concat(like'%',#{search},'%')
            </when>
        </choose>
    </sql>


<!--  게시물 총 내용  -->
    <select id="countAll" resultType="int" parameterType="com.adnstyle.myboard.model.domain.PageHandle">
    select count(*)
     from my_board
    <include refid="searchContents"></include>
    </select>

<!-- 고객들이 볼 게시판 화면-->
    <select id="myBoardPage"  parameterType="map" resultType="com.adnstyle.myboard.model.domain.MyBoard">
        select id, title, view_count, modified_date, modified_by
        from my_board
        where del_yn = 'N'
        order by id desc
        limit #{offset}, #{pageSize}
    </select>

    <select id="selectList"  parameterType="map" resultType="com.adnstyle.myboard.model.domain.MyBoard">
        select id, title, view_count, modified_date, modified_by,del_yn
        from my_board
        <include refid="searchContents"></include>
        order by id desc
        limit #{offset}, #{pageSize}
    </select>
<!--게시글 상세조회-->
    <select id="selectContent" parameterType="long" resultType="com.adnstyle.myboard.model.domain.MyBoard">
        select title, modified_by,content,modified_date,id
        from my_board
        where id=#{id};
    </select>

    <update id="updateCount" parameterType="long">
        update my_board set view_count= view_count+1
        where id=#{id}
    </update>

    <update id="deleteContent" parameterType="long">
        update my_board set del_yn = 'Y'
        where id=#{id}
    </update>

    <select id="selectId" resultType="long">
        SELECT ID
        FROM my_board
        ORDER BY ID DESC
        limit 1;
    </select>

    <insert id="insertContent" parameterType="com.adnstyle.myboard.model.domain.MyBoard">
        insert into my_board (title, content ,view_count,created_by,modified_by,created_date,modified_date)
        values (#{title},#{content},0,#{createdBy},#{createdBy},NOW(),NOW())
    </insert>

    <update id="updateContent" parameterType="com.adnstyle.myboard.model.domain.MyBoard">
         update my_board set title = #{title}, content=#{content},modified_by=#{modifiedBy},modified_date=NOW()
         where id=#{id}
     </update>

</mapper>