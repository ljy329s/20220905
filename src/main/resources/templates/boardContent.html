<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>게시글 읽기</title>
</head>
<style>
    #main{
        margin: auto 0;
        text-align: center;
    }

    form{
        text-align: center;
    }
    textarea{
        resize: none;
    }

</style>
<body>
<div id="main">
    <div class="container">
        <h1 id="mainTitle">게시글읽기</h1>
        <form action="/updateContent" method="post" id="contentForm" enctype="multipart/form-data" th:each="myContent : ${myContent}">
            <div><p>제목</p><input type="text" name="title" th:value="${myContent.title}" class="form" readonly="readonly"/></div>
            <div><p>작성자</p><input type="text" name="modifiedBy" th:value="${myContent.modifiedBy}" class="form" readonly="readonly"/></div>
            <div><p>내용</p>

                <div>
                <input type="text" name="page" th:value="${page}">
                <input type="text" name="type" th:value="${type}">
                <input type="text" name="search" th:value="${search}">
                </div>
                <textarea cols="50" rows="20" name="content" th:text="${myContent.content}" class="form" readonly="readonly"/></textarea></div>


            <input type="hidden" name="id" th:value="${myContent.id}">
<!--첨부파일 추가 테스트용-->
            <input type="file" id="onlyAttach" style="display: none" name="uploadFile" multiple>


            <div class="btn-group" role="group" aria-label="Basic example">
            <button type="button" class="btn btn-primary" id="upd_btn" style="display: inline">수정하기</button>
            <button type="submit" class="btn btn-primary" id="upd_sub" style="display: none">수정완료</button>
                <!--이전에보던 페이지 위치로 이동함 -->
            <button type="button" class="btn btn-primary" th:onclick="|location.href='@{main(page=${page},type=${type},search=${search})}'|">목록</button>
            <!-- th:onclick="|location.href='@{deleteContent(id=${myContent.id})}'|" [경로에 파라미터 같이 보내는법] 앞뒤로 | 적어줘야함 -->
            <button type="button" class="btn btn-primary" th:onclick="|location.href='@{deleteContent(id=${myContent.id})}'|">삭제</button>
            </div>

        </form>
        <div>
            <p>첨부파일</p>
              <th:block th:each="attachList : ${attachList}">
               <div class="aaa" style="display:flex;"><a th:href="@{/downloadFile(fileName = ${attachList.uuid}, uploadPath = ${attachList.uploadPath})}"><p th:text="${attachList.originName}"/></a><button type="button" class="delete" id="${attachList.uuid}" style="display: none">x</button></div>
              </th:block>
        </div>

    </div>
</div>
<script>
    //제이쿼리 없이 바닐라js로 (부트스트랩5 사용예정)

    //수정버튼 클릭시 upd_btnE 함수를 실행해라
    const upd_btn = document.getElementById("upd_btn")
        upd_btn.addEventListener('click',upd_btnE);

    //수정버튼 클릭시 upd_btnE 실행
    function upd_btnE(){
        //기존 수정하기 버튼 가리기
        document.getElementById("upd_btn").style.display="none";
        //수정완료 버튼 보이게 하기
        document.getElementById("upd_sub").style.display="inline";
        let mainTitleU = document.getElementById("mainTitle");//게시글읽기->게시글수정으로 변경
        mainTitleU.innerText="게시글수정";
        //파일추가 보이게 하기
        document.getElementById("onlyAttach").style.display="inline";

        //첨부파일 삭제 버튼 보이게하기
        const deleteBtn = document.getElementsByClassName("delete");
        for(let i=0; i<deleteBtn.length;i++){
            deleteBtn[i].style.display="inline";
        }

        //input의 class이름을 가지고 for문을 돌려서 readOnly를 false로(텍스트 수정가능하게)
        let formU = document.getElementsByClassName("form");
        for(let i = 0; i < formU.length; i++){
            formU[i].readOnly=false;
        }

        //삭제버튼 클릭시
        let remove = document.getElementById("delete");
        console.log("삭제버튼클릭");
            remove.addEventListener('click',hideE);

        //첨부파일 가려지게
        function hideE(){
            console.log("hideE함수실행");
            document.getElementById("delete").style.display="none";

        }
    }


</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

</body>
</html>